---
import PostLayout from "../../layouts/PostLayout.astro"
import metadata from "../../metadata.ts"

export async function getStaticPaths({ rss }) {
  const { description } = metadata as Metadata
  const { hostname } = Astro.site
  const posts = (await Astro.glob<Post>("./*.md"))
    .sort((a,b) => (a.frontmatter.published < b.frontmatter.published) ? 1 : -1)
    .map(x => ({ ...x.frontmatter, content: x.Content, url: x.url }))
  rss({
    title: hostname,
    description,
    items: posts.map(post => ({
      title: post.title,
      description: post.description,
      link: post.url,
      pubDate: post.published,
    })),
  });
  return posts.map(post => ({
      params: {
        post: post.url.replace("/posts/", ""),
      },
      props: {
        post,
      }
    }))
}

export interface Props {
  post: Post
}

const { post } = Astro.props as Props


---
<PostLayout content={post} />